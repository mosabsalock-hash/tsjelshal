<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¹Ø§ØªÙŠ - Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ</title>
<style>
/* Ù†ÙØ³ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© - Ù„Ù… ÙŠØªÙ… ØªØºÙŠÙŠØ±Ù‡Ø§ */
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
padding: 20px;
}

/* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
.login-screen {
max-width: 400px;
margin: 100px auto;
background: white;
border-radius: 20px;
padding: 40px;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
text-align: center;
}

.login-screen h2 {
color: #2c3e50;
margin-bottom: 30px;
font-size: 2em;
}

.login-screen input {
width: 100%;
padding: 15px;
margin: 10px 0;
border: 2px solid #e0e0e0;
border-radius: 10px;
font-size: 1em;
}

.login-screen button {
width: 100%;
padding: 15px;
background: #667eea;
color: white;
border: none;
border-radius: 10px;
font-size: 1.1em;
font-weight: bold;
cursor: pointer;
margin-top: 20px;
}

.login-screen button:hover {
background: #764ba2;
}

.user-type {
margin: 20px 0;
display: flex;
gap: 10px;
justify-content: center;
}

.user-type label {
display: flex;
align-items: center;
gap: 5px;
cursor: pointer;
}

/* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.success-popup {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: rgba(0,0,0,0.7);
display: flex;
justify-content: center;
align-items: center;
z-index: 2000;
display: none;
}

.success-popup-content {
background: white;
padding: 40px;
border-radius: 20px;
max-width: 400px;
text-align: center;
animation: popup 0.5s ease;
}

@keyframes popup {
0% { transform: scale(0.7); opacity: 0; }
100% { transform: scale(1); opacity: 1; }
}

.success-popup-content .icon {
font-size: 5em;
margin-bottom: 20px;
}

.success-popup-content h2 {
color: #27ae60;
margin-bottom: 15px;
font-size: 2em;
}

.success-popup-content p {
color: #2c3e50;
font-size: 1.2em;
margin-bottom: 25px;
}

.success-popup-content button {
background: #27ae60;
color: white;
border: none;
padding: 15px 40px;
border-radius: 10px;
font-size: 1.1em;
font-weight: bold;
cursor: pointer;
transition: all 0.3s;
}

.success-popup-content button:hover {
background: #219a52;
transform: translateY(-2px);
box-shadow: 0 10px 30px rgba(39, 174, 96, 0.3);
}

/* Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¯ÙŠØ± */
.admin-screen, .worker-screen {
display: none;
}

.container {
max-width: 1200px;
margin: 0 auto;
background: white;
border-radius: 20px;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
overflow: hidden;
}

.header {
background: #2c3e50;
color: white;
padding: 20px 30px;
display: flex;
justify-content: space-between;
align-items: center;
}

.header h1 {
font-size: 2em;
}

.logout-btn {
background: #e74c3c;
color: white;
border: none;
padding: 10px 20px;
border-radius: 10px;
cursor: pointer;
font-size: 1em;
}

.main-content {
padding: 30px;
}

/* Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø§Ù…Ù„ */
.worker-simple {
max-width: 600px;
margin: 30px auto;
background: white;
border-radius: 20px;
padding: 30px;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}

.worker-simple h2 {
color: #2c3e50;
text-align: center;
margin-bottom: 30px;
font-size: 2em;
}

.worker-info {
background: #e3f2fd;
padding: 20px;
border-radius: 15px;
margin-bottom: 25px;
text-align: center;
border: 2px solid #2196f3;
}

.worker-info .label {
color: #0d47a1;
font-size: 1.1em;
margin-bottom: 5px;
}

.worker-info .name {
color: #1565c0;
font-size: 2em;
font-weight: bold;
}

.current-time {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
padding: 20px;
border-radius: 15px;
text-align: center;
margin-bottom: 25px;
}

.current-time .time-label {
font-size: 1.1em;
opacity: 0.9;
margin-bottom: 5px;
}

.current-time .time-value {
font-size: 2.5em;
font-weight: bold;
font-family: monospace;
direction: ltr;
}

.current-time .date-value {
font-size: 1.2em;
margin-top: 5px;
direction: ltr;
font-family: 'Segoe UI', Arial, sans-serif;
}

.time-input-group {
background: #f8f9fa;
padding: 20px;
border-radius: 15px;
margin-bottom: 20px;
}

.time-input-group label {
display: block;
margin-bottom: 10px;
color: #2c3e50;
font-weight: bold;
font-size: 1.1em;
}

.time-input-group input {
width: 100%;
padding: 15px;
border: 2px solid #e0e0e0;
border-radius: 10px;
font-size: 1.1em;
font-family: monospace;
direction: ltr;
}

.time-input-group input:focus {
outline: none;
border-color: #667eea;
box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.time-display {
background: #e8f5e9;
padding: 20px;
border-radius: 15px;
margin: 20px 0;
text-align: center;
}

.time-display .label {
color: #2e7d32;
font-size: 1.1em;
margin-bottom: 5px;
}

.time-display .value {
color: #1b5e20;
font-size: 2em;
font-weight: bold;
direction: ltr;
}

.warning-message {
background: #fff3e0;
color: #e65100;
padding: 15px;
border-radius: 10px;
margin: 15px 0;
text-align: center;
font-weight: bold;
}

.duplicate-message {
background: #ffebee;
color: #c62828;
padding: 15px;
border-radius: 10px;
margin: 15px 0;
text-align: center;
font-weight: bold;
border: 2px solid #ef5350;
}

.worker-simple input, .worker-simple textarea {
width: 100%;
padding: 12px;
margin: 10px 0;
border: 2px solid #e0e0e0;
border-radius: 10px;
font-size: 1em;
}

.worker-simple button {
width: 100%;
padding: 15px;
background: #27ae60;
color: white;
border: none;
border-radius: 10px;
font-size: 1.1em;
font-weight: bold;
cursor: pointer;
margin-top: 20px;
transition: all 0.3s;
}

.worker-simple button:hover:not(:disabled) {
background: #219a52;
transform: translateY(-2px);
box-shadow: 0 10px 30px rgba(39, 174, 96, 0.3);
}

.worker-simple button:disabled {
background: #b0bec5;
cursor: not-allowed;
opacity: 0.6;
}

/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ± */
.stats-container {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 20px;
margin-bottom: 30px;
}

.stat-card {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
padding: 20px;
border-radius: 15px;
text-align: center;
}

.stat-card .number {
font-size: 2em;
font-weight: bold;
direction: ltr;
}

.filters {
display: flex;
gap: 15px;
margin-bottom: 20px;
flex-wrap: wrap;
align-items: center;
}

.search-box, .filter-select {
padding: 12px;
border: 2px solid #e0e0e0;
border-radius: 10px;
font-size: 1em;
flex: 1;
min-width: 200px;
}

.action-buttons-group {
display: flex;
gap: 10px;
margin-right: auto;
}

.action-btn {
padding: 12px 20px;
border: none;
border-radius: 10px;
cursor: pointer;
font-size: 0.95em;
font-weight: 600;
transition: all 0.3s;
}

.export-btn {
background: #27ae60;
color: white;
}
.export-btn:hover { background: #219a52; }

.delete-all-btn {
background: #e74c3c;
color: white;
}
.delete-all-btn:hover { background: #c0392b; }

.table-container {
overflow-x: auto;
background: white;
border-radius: 15px;
box-shadow: 0 5px 20px rgba(0,0,0,0.1);
margin-top: 20px;
}

table {
width: 100%;
border-collapse: collapse;
}

th {
background: #2c3e50;
color: white;
padding: 15px;
font-size: 0.95em;
}

td {
padding: 15px;
text-align: center;
border-bottom: 1px solid #ecf0f1;
}

tr:hover {
background: #f8f9fa;
}

.delete-record-btn {
background: #e74c3c;
color: white;
border: none;
padding: 5px 15px;
border-radius: 5px;
cursor: pointer;
font-size: 0.9em;
}

.delete-record-btn:hover {
background: #c0392b;
}

.confirm-dialog {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: rgba(0,0,0,0.5);
display: flex;
justify-content: center;
align-items: center;
z-index: 1000;
display: none;
}

.confirm-content {
background: white;
padding: 30px;
border-radius: 15px;
max-width: 400px;
text-align: center;
}

.confirm-content h3 {
color: #2c3e50;
margin-bottom: 15px;
}

.confirm-content p {
color: #7f8c8d;
margin-bottom: 25px;
}

.confirm-buttons {
display: flex;
gap: 10px;
justify-content: center;
}

.confirm-btn {
padding: 10px 30px;
border: none;
border-radius: 8px;
cursor: pointer;
font-size: 1em;
}

.confirm-yes {
background: #e74c3c;
color: white;
}

.confirm-no {
background: #95a5a6;
color: white;
}

.time-details {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 15px;
margin: 20px 0;
}

.time-box {
background: #f8f9fa;
padding: 15px;
border-radius: 10px;
text-align: center;
}

.time-box .title {
color: #7f8c8d;
font-size: 0.9em;
margin-bottom: 5px;
}

.time-box .time {
color: #2c3e50;
font-size: 1.3em;
font-weight: bold;
font-family: monospace;
direction: ltr;
}
</style>
</head>
<body>
<!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
<div id="successPopup" class="success-popup">
<div class="success-popup-content">
<div class="icon">âœ…</div>
<h2>ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!</h2>
<p id="successMessageText">ØªÙ… Ø­ÙØ¸ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</p>
<button onclick="closeSuccessAndGoHome()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
</div>
</div>

<!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginScreen" class="login-screen">
<h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
<div class="user-type">
<label>
<input type="radio" name="userType" value="admin" checked> Ù…Ø¯ÙŠØ±
</label>
<label>
<input type="radio" name="userType" value="worker"> Ø¹Ø§Ù…Ù„
</label>
</div>
<input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
<input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¯ÙŠØ± -->
<div id="adminScreen" class="admin-screen">
<div class="container">
<div class="header">
<h1>ğŸ‘‘ ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¹Ø§ØªÙŠ - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
<button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div class="main-content">
<div class="stats-container">
<div class="stat-card">
<h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ø§Ù„</h3>
<div class="number" id="totalWorkers">0</div>
</div>
<div class="stat-card">
<h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</h3>
<div class="number" id="totalHours">0</div>
</div>
<div class="stat-card">
<h3>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø§Ø¹Ø§Øª</h3>
<div class="number" id="avgHours">0</div>
</div>
<div class="stat-card">
<h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</h3>
<div class="number" id="totalRecords">0</div>
</div>
</div>

<div class="filters">
<input type="text" id="searchInput" class="search-box" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ Ø£Ùˆ Ø§Ù„Ù…Ù‡Ù…Ø©...">
<select id="workerFilter" class="filter-select">
<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ø§Ù„</option>
</select>
<div class="action-buttons-group">
<button class="action-btn export-btn" onclick="exportToExcel()">ğŸ“¥ ØªØµØ¯ÙŠØ± Excel</button>
<button class="action-btn delete-all-btn" onclick="showDeleteAllConfirm()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
</div>
</div>

<div class="table-container">
<table id="workTable">
<thead>
<tr>
<th>#</th>
<th>Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„</th>
<th>Ø§Ù„Ù…Ù‡Ù…Ø©</th>
<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</th>
<th>ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</th>
<th>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</th>
<th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
<th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<div style="margin-top: 20px; color: #7f8c8d; text-align: left;">
<small>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©: <span id="displayedRecords">0</span></small>
</div>
</div>
</div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø§Ù…Ù„ -->
<div id="workerScreen" class="worker-screen">
<div class="worker-simple">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
<h2>â° ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¹Ø§ØªÙŠ</h2>
<button class="logout-btn" onclick="logout()" style="width: auto; padding: 8px 15px;">Ø®Ø±ÙˆØ¬</button>
</div>

<div class="worker-info">
<div class="label">ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„</div>
<div class="name" id="displayWorkerName"></div>
</div>

<div class="current-time">
<div class="time-label">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ (ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©)</div>
<div class="time-value" id="currentTimeDisplay">--:--:--</div>
<div class="date-value" id="currentDateDisplay"></div>
</div>

<div id="duplicateMessage" class="duplicate-message" style="display: none;">
âš ï¸ Ù„Ù‚Ø¯ Ø³Ø¬Ù„Øª Ø³Ø§Ø¹Ø§ØªÙƒ Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ø§Ù„ÙŠÙˆÙ…
</div>

<form id="workerForm" onsubmit="return false;">
<input type="hidden" id="workerName">
<input type="text" id="workerJob" placeholder="Ø§Ù„Ù…Ù‡Ù…Ø©" required>

<div class="time-input-group">
<label>â±ï¸ ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„</label>
<input type="time" id="startTime" required>
</div>

<div class="time-details">
<div class="time-box">
<div class="title">ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</div>
<div class="time" id="displayStartTime">--:--</div>
</div>
<div class="time-box">
<div class="title">ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Ø§Ù„Ø¢Ù†)</div>
<div class="time" id="displayEndTime">--:--</div>
</div>
</div>

<div class="time-display">
<div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙˆÙ‚Øª Ø§Ù„Ø¹Ù…Ù„</div>
<div class="value" id="totalHoursDisplay">0 Ø³Ø§Ø¹Ø©</div>
</div>

<div id="timeWarning" class="warning-message" style="display: none;">
âš ï¸ ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
</div>

<textarea id="notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" rows="3"></textarea>

<button type="button" id="submitBtn" onclick="submitWorkerHours()">âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</button>
</form>

<div style="margin-top: 20px; text-align: center; color: #7f8c8d; font-size: 0.9em;">
<p>â° ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
</div>
</div>
</div>

<!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ÙƒÙ„ -->
<div id="confirmDialog" class="confirm-dialog">
<div class="confirm-content">
<h3>ğŸ—‘ï¸ ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</h3>
<p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ØŸ</p>
<p style="color: #e74c3c; font-weight: bold;">Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!</p>
<div class="confirm-buttons">
<button class="confirm-btn confirm-yes" onclick="deleteAllRecords()">Ù†Ø¹Ù…ØŒ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
<button class="confirm-btn confirm-no" onclick="hideDeleteAllConfirm()">Ø¥Ù„ØºØ§Ø¡</button>
</div>
</div>
</div>

<script>
// ==================== Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ====================
// Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø¥Ù„Ù‰ Ù†Øµ
function formatHoursToText(hours) {
let totalMinutes = Math.round(hours * 60);
let h = Math.floor(totalMinutes / 60);
let m = totalMinutes % 60;

if (h === 0) return m + ' Ø¯Ù‚ÙŠÙ‚Ø©';
if (m === 0) return h + ' Ø³Ø§Ø¹Ø©';
return h + ' Ø³Ø§Ø¹Ø© Ùˆ ' + m + ' Ø¯Ù‚ÙŠÙ‚Ø©';
}

// Ø¯Ø§Ù„Ø© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø§Ù„Ø¹Ø¨Ø±ÙŠØ©
function formatDateInHebrew(dateString) {
let date = new Date(dateString);

// Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£ÙŠØ§Ù… Ø¨Ø§Ù„Ø¹Ø¨Ø±ÙŠØ©
let weekdays = ['×™×•× ×¨××©×•×Ÿ', '×™×•× ×©× ×™', '×™×•× ×©×œ×™×©×™', '×™×•× ×¨×‘×™×¢×™', '×™×•× ×—××™×©×™', '×™×•× ×©×™×©×™', '×©×‘×ª'];

// Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø´Ù‡Ø± Ø¨Ø§Ù„Ø¹Ø¨Ø±ÙŠØ©
let months = ['×™× ×•××¨', '×¤×‘×¨×•××¨', '××¨×¥', '××¤×¨×™×œ', '×××™', '×™×•× ×™', '×™×•×œ×™', '××•×’×•×¡×˜', '×¡×¤×˜××‘×¨', '××•×§×˜×•×‘×¨', '× ×•×‘××‘×¨', '×“×¦××‘×¨'];

let day = weekdays[date.getDay()];
let dayNum = date.getDate();
let month = months[date.getMonth()];
let year = date.getFullYear();

return day + ', ' + dayNum + ' ' + month + ' ' + year;
}

// Ø¯Ø§Ù„Ø© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‚ØµÙŠØ± (Ù„Ù„Ù…Ø¯ÙŠØ±)
function formatShortDate(dateString) {
let date = new Date(dateString);
let day = date.getDate().toString().padStart(2, '0');
let month = (date.getMonth() + 1).toString().padStart(2, '0');
let year = date.getFullYear();
return day + '/' + month + '/' + year;
}

// Ø¯Ø§Ù„Ø© Ø¥ØºÙ„Ø§Ù‚ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
function closeSuccessAndGoHome() {
document.getElementById('successPopup').style.display = 'none';
logout();
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙƒØ±Ø±
function checkDuplicateToday(workerName) {
let today = new Date().toISOString().split('T')[0];
for (let i = 0; i < workRecords.length; i++) {
if (workRecords[i].workerName === workerName && workRecords[i].date === today) {
return true;
}
}
return false;
}

// ==================== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù† ====================
function loadData() {
try {
let savedData = localStorage.getItem('workRecords');
if (savedData) {
workRecords = JSON.parse(savedData);
// Ø§Ù„ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØµÙÙˆÙØ©
if (!Array.isArray(workRecords)) {
workRecords = [];
}
} else {
workRecords = [];
}
} catch (e) {
console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', e);
workRecords = [];
}
}

// ==================== Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ localStorage Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù† ====================
function saveData() {
try {
localStorage.setItem('workRecords', JSON.stringify(workRecords));
console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', workRecords.length); // Ù„Ù„ØªØ£ÙƒØ¯
} catch (e) {
console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', e);
alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
}
}

// Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
const ADMIN_USERNAME = "admin";
const ADMIN_PASSWORD = "admin123";
let workRecords = [];
let timeUpdateInterval;
let currentWorkerName = "";

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
loadData();

// ==================== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ====================
function login() {
let userType = document.querySelector('input[name="userType"]:checked').value;
let username = document.getElementById('username').value.trim();
let password = document.getElementById('password').value;

if (userType === 'admin') {
if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
document.getElementById('loginScreen').style.display = 'none';
document.getElementById('adminScreen').style.display = 'block';
document.getElementById('workerScreen').style.display = 'none';
displayAdminRecords();
updateAdminStats();
if (timeUpdateInterval) clearInterval(timeUpdateInterval);
} else {
alert('âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
}
} else {
if (username && password) {
currentWorkerName = username;
document.getElementById('loginScreen').style.display = 'none';
document.getElementById('adminScreen').style.display = 'none';
document.getElementById('workerScreen').style.display = 'block';

document.getElementById('displayWorkerName').textContent = currentWorkerName;
document.getElementById('workerName').value = currentWorkerName;

startTimeUpdates();
setDefaultStartTime();
checkAndShowDuplicateMessage();
} else {
alert('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
}
}
}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
function logout() {
document.getElementById('loginScreen').style.display = 'block';
document.getElementById('adminScreen').style.display = 'none';
document.getElementById('workerScreen').style.display = 'none';
document.getElementById('username').value = '';
document.getElementById('password').value = '';
hideDeleteAllConfirm();
if (timeUpdateInterval) clearInterval(timeUpdateInterval);
currentWorkerName = "";
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø± ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø©
function checkAndShowDuplicateMessage() {
let isDuplicate = checkDuplicateToday(currentWorkerName);
let duplicateMsg = document.getElementById('duplicateMessage');
let submitBtn = document.getElementById('submitBtn');

if (isDuplicate) {
duplicateMsg.style.display = 'block';
submitBtn.disabled = true;
} else {
duplicateMsg.style.display = 'none';
submitBtn.disabled = false;
}
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
function startTimeUpdates() {
timeUpdateInterval = setInterval(updateCurrentTime, 1000);
updateCurrentTime();
}

function updateCurrentTime() {
let now = new Date();
let hours = now.getHours().toString().padStart(2, '0');
let minutes = now.getMinutes().toString().padStart(2, '0');
let seconds = now.getSeconds().toString().padStart(2, '0');
let timeString = hours + ':' + minutes + ':' + seconds;

// Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø§Ù„Ø¹Ø¨Ø±ÙŠØ©
let dateString = formatDateInHebrew(now);

document.getElementById('currentTimeDisplay').textContent = timeString;
document.getElementById('currentDateDisplay').textContent = dateString;
document.getElementById('displayEndTime').textContent = hours + ':' + minutes;

calculateHours();
}

function setDefaultStartTime() {
let now = new Date();
now.setHours(now.getHours() - 1);
let hours = now.getHours().toString().padStart(2, '0');
let minutes = now.getMinutes().toString().padStart(2, '0');
let defaultTime = hours + ':' + minutes;

document.getElementById('startTime').value = defaultTime;
document.getElementById('displayStartTime').textContent = defaultTime;
calculateHours();
}

function calculateHours() {
let startTimeInput = document.getElementById('startTime').value;
if (!startTimeInput) {
document.getElementById('totalHoursDisplay').textContent = '0 Ø³Ø§Ø¹Ø©';
return;
}

let now = new Date();
let startParts = startTimeInput.split(':');
let startHours = parseInt(startParts[0]);
let startMinutes = parseInt(startParts[1]);

let startDate = new Date(now);
startDate.setHours(startHours, startMinutes, 0, 0);

if (startDate > now) {
document.getElementById('timeWarning').style.display = 'block';
document.getElementById('submitBtn').disabled = true;
document.getElementById('totalHoursDisplay').textContent = 'âš ï¸ ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­';
return;
}

document.getElementById('timeWarning').style.display = 'none';

if (checkDuplicateToday(currentWorkerName)) {
document.getElementById('submitBtn').disabled = true;
} else {
document.getElementById('submitBtn').disabled = false;
}

let diffMs = now - startDate;
let diffHours = diffMs / (1000 * 60 * 60);

document.getElementById('totalHoursDisplay').textContent = formatHoursToText(diffHours);
document.getElementById('displayStartTime').textContent = startTimeInput;
}

// ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„
function submitWorkerHours() {
let workerName = currentWorkerName;
let workerJob = document.getElementById('workerJob').value.trim();
let startTime = document.getElementById('startTime').value;
let notes = document.getElementById('notes').value.trim();

if (!workerJob || !startTime) {
alert('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
return;
}

if (checkDuplicateToday(workerName)) {
alert('âŒ Ù„Ù‚Ø¯ Ø³Ø¬Ù„Øª Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ø§Ù„ÙŠÙˆÙ…');
checkAndShowDuplicateMessage();
return;
}

let now = new Date();
let startParts = startTime.split(':');
let startHours = parseInt(startParts[0]);
let startMinutes = parseInt(startParts[1]);
let startDate = new Date(now);
startDate.setHours(startHours, startMinutes, 0, 0);

if (startDate > now) {
alert('âŒ ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ');
return;
}

let diffMs = now - startDate;
let hoursWorked = diffMs / (1000 * 60 * 60);

let newRecord = {
id: Date.now(),
workerName: workerName,
job: workerJob,
date: now.toISOString().split('T')[0],
startTime: startTime,
endTime: now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0'),
hours: hoursWorked,
hoursText: formatHoursToText(hoursWorked),
notes: notes,
timestamp: now.toISOString()
};

workRecords.push(newRecord);
saveData(); // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©

// Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
document.getElementById('successMessageText').textContent = 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ ' + formatHoursToText(hoursWorked) + ' Ø¨Ù†Ø¬Ø§Ø­';
document.getElementById('successPopup').style.display = 'flex';
}

// ==================== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø¯ÙŠØ± ====================
function displayAdminRecords() {
let searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
let workerFilter = document.getElementById('workerFilter')?.value || 'all';

let filteredRecords = [];
for (let i = 0; i < workRecords.length; i++) {
filteredRecords.push(workRecords[i]);
}

if (searchTerm) {
let temp = [];
for (let i = 0; i < filteredRecords.length; i++) {
let r = filteredRecords[i];
if (r.workerName.toLowerCase().includes(searchTerm) || r.job.toLowerCase().includes(searchTerm)) {
temp.push(r);
}
}
filteredRecords = temp;
}

if (workerFilter !== 'all') {
let temp = [];
for (let i = 0; i < filteredRecords.length; i++) {
if (filteredRecords[i].workerName === workerFilter) {
temp.push(filteredRecords[i]);
}
}
filteredRecords = temp;
}

filteredRecords.sort(function(a, b) {
return new Date(b.date) - new Date(a.date);
});

let tbody = document.getElementById('tableBody');
if (!tbody) return;

tbody.innerHTML = '';

if (filteredRecords.length === 0) {
tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 50px; color: #7f8c8d;">ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</td></tr>';
} else {
for (let i = 0; i < filteredRecords.length; i++) {
let r = filteredRecords[i];
let row = tbody.insertRow();
row.innerHTML = `
<td>${i + 1}</td>
<td><strong>${r.workerName}</strong></td>
<td>${r.job}</td>
<td>${formatShortDate(r.date)}</td>
<td>${r.startTime || '--:--'}</td>
<td>${r.endTime || '--:--'}</td>
<td>${r.hoursText || formatHoursToText(r.hours)}</td>
<td>${r.notes || '-'}</td>
<td><button class="delete-record-btn" onclick="adminDeleteRecord(${r.id})">ğŸ—‘ï¸ Ø­Ø°Ù</button></td>
`;
}
}

document.getElementById('displayedRecords').textContent = filteredRecords.length;
updateWorkerFilter();
updateAdminStats();
}

function adminDeleteRecord(id) {
if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ')) {
let newRecords = [];
for (let i = 0; i < workRecords.length; i++) {
if (workRecords[i].id !== id) {
newRecords.push(workRecords[i]);
}
}
workRecords = newRecords;
saveData(); // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
displayAdminRecords(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
}
}

function showDeleteAllConfirm() {
if (workRecords.length === 0) {
alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­Ø°Ù');
return;
}
document.getElementById('confirmDialog').style.display = 'flex';
}

function hideDeleteAllConfirm() {
document.getElementById('confirmDialog').style.display = 'none';
}

function deleteAllRecords() {
workRecords = [];
saveData(); // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù Ø§Ù„ÙƒÙ„ÙŠ
hideDeleteAllConfirm();
displayAdminRecords(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
setTimeout(() => {
alert('âœ… ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
}, 100);
}

function updateAdminStats() {
let workers = [];
let totalHours = 0;
for (let i = 0; i < workRecords.length; i++) {
if (!workers.includes(workRecords[i].workerName)) {
workers.push(workRecords[i].workerName);
}
totalHours += workRecords[i].hours;
}

document.getElementById('totalWorkers').textContent = workers.length;
document.getElementById('totalHours').textContent = totalHours.toFixed(1);
document.getElementById('avgHours').textContent = workRecords.length > 0 ? (totalHours / workRecords.length).toFixed(1) : 0;
document.getElementById('totalRecords').textContent = workRecords.length;
}

function updateWorkerFilter() {
let workers = [];
for (let i = 0; i < workRecords.length; i++) {
if (!workers.includes(workRecords[i].workerName)) {
workers.push(workRecords[i].workerName);
}
}

let filterSelect = document.getElementById('workerFilter');
if (!filterSelect) return;

let currentValue = filterSelect.value;
filterSelect.innerHTML = '<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ø§Ù„</option>';

workers.sort();
for (let i = 0; i < workers.length; i++) {
let option = document.createElement('option');
option.value = workers[i];
option.textContent = workers[i];
filterSelect.appendChild(option);
}

if (currentValue && workers.includes(currentValue)) {
filterSelect.value = currentValue;
}
}

function exportToExcel() {
if (workRecords.length === 0) {
alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
return;
}

let text = 'Ø§Ù„Ø§Ø³Ù…,Ø§Ù„Ù…Ù‡Ù…Ø©,Ø§Ù„ØªØ§Ø±ÙŠØ®,ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©,ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©,Ø§Ù„Ø³Ø§Ø¹Ø§Øª,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n';

for (let i = 0; i < workRecords.length; i++) {
let r = workRecords[i];
text += r.workerName + ',' + r.job + ',' + formatShortDate(r.date) + ',' +
(r.startTime || '') + ',' + (r.endTime || '') + ',"' +
(r.hoursText || formatHoursToText(r.hours)) + '","' + (r.notes || '') + '"\n';
}

let blob = new Blob(['\uFEFF' + text], { type: 'text/csv;charset=utf-8;' });
let link = document.createElement('a');
link.href = URL.createObjectURL(blob);
link.download = 'ØªÙ‚Ø±ÙŠØ±_Ø³Ø§Ø¹Ø§Øª_Ø§Ù„Ø¹Ù…Ù„_' + new Date().toISOString().split('T')[0] + '.csv';
link.click();
alert('âœ… ØªÙ… ØªØµØ¯ÙŠØ± ' + workRecords.length + ' Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­');
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
function setupEventListeners() {
if (document.getElementById('searchInput')) {
document.getElementById('searchInput').addEventListener('input', displayAdminRecords);
}
if (document.getElementById('workerFilter')) {
document.getElementById('workerFilter').addEventListener('change', displayAdminRecords);
}
document.getElementById('startTime')?.addEventListener('change', calculateHours);
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
window.onload = function() {
document.getElementById('loginScreen').style.display = 'block';
document.getElementById('adminScreen').style.display = 'none';
document.getElementById('workerScreen').style.display = 'none';
setupEventListeners();

window.onclick = function(event) {
let dialog = document.getElementById('confirmDialog');
if (event.target === dialog) {
hideDeleteAllConfirm();
}
};
}
</script>
</body>
</html>
